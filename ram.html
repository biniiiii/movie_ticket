<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta http-equiv="X-UA-Compatible" content="ie=edge" />
    <title>Movie Ticket Booking</title>
    <style>@import url("https://fonts.googleapis.com/css?family=Lato&display=swap");

        * {
          box-sizing: border-box;
        }
    
        body {
          background-image: url(pics/2.jpg);
          background-size: cover;
          color: #fff;
          display: flex;
          flex-direction: column;
          align-items: center;
          justify-content: center;
          height: 100vh;
          font-family: "Lato", sans-serif;
          margin: 0;
        }
    
        .movie-container {
          margin: 20px 0;
          align-items: center;
          justify-content: center;
        }
    
        .movie-container select {
          background-color: #fff;
          border: 0;
          border-radius: 5px;
          font-size: 16px;
          margin-left: 10px;
          padding: 5px 15px;
          -moz-appearance: none;
          -webkit-appearance: none;
          appearance: none;
        }
    
        .container {
          perspective: 1000px;
          margin-bottom: 30px;
        }
    
        .seat {
          background-color: #444451;
          height: 26px;
          width: 32px;
          margin: 3px;
          border-top-left-radius: 10px;
          border-top-right-radius: 10px;
        }
    
        .seat.selected {
          background-color: green;
          color: green;
        }
    
        .seat.sold {
          background-color: #fff;
          pointer-events: none;
        }
    
        .seat:not(.sold):hover {
          cursor: pointer;
          transform: scale(1.2);
        }
    
        .showcase {
          background: rgba(0, 0, 0, 0.1);
          padding: 5px 10px;
          border-radius: 5px;
          color: #777;
          list-style-type: none;
          display: flex;
          justify-content: space-between;
        }
    
        .showcase li {
          display: flex;
          align-items: center;
          justify-content: center;
          margin: 0 10px;
        }
    
        .row {
          display: flex;
        }
    
        .screen {
          background-color: #fff;
          height: 120px;
          width: 100%;
          margin: 15px 0;
          transform: rotateX(-58deg);
          box-shadow: 0 3px 10px rgba(255, 255, 255, 0.7);
        }
    
        .buttons {
          margin-top: 10px;
        }
    
        .button {
          background-color: #28a745;
          border: none;
          color: white;
          padding: 10px 20px;
          margin: 5px;
          cursor: pointer;
          font-size: 16px;
          border-radius: 5px;
        }
    
        .button:hover {
          opacity: 0.8;
        }
        
        .button.undo {
          background-color: #dc3545;
        }
        
        .button.done {
          background-color: #007bff;
        }
        
        .button.reset {
          background-color: #ff9800;
        }
        
        .box {
          justify-content: center;
          align-items: center;
          background-color: black;
          padding: 2% 3% 2% 3%;
          border-radius: 30px;
          opacity: 88%;
        }</style>
  </head>
 
  <body>
    <div class="box">
      <div class="movie-container">
        <label>Select a movie:</label>
        <select id="movie">
          <option value="220">Men in Black (₹220)</option>
          <option value="200">Inerstellar (₹200)</option>
          <option value="250">Se7en (₹250)</option>
        </select>
      </div>
    
      <ul class="showcase">
        <li>
          <div class="seat"></div>
          <small>Available</small>
        </li>
        <li>
          <div class="seat selected"></div>
          <small>Selected</small>
        </li>
        <li>
          <div class="seat sold"></div>
          <small>Sold</small>
        </li>
      </ul>
    
      
    <div class="container">
      <div class="screen"></div>

      <div class="row">
        <div class="seat"></div>
        <div class="seat"></div>
        <div class="seat"></div>
        <div class="seat"></div>
        <div class="seat"></div>
        <div class="seat"></div>
        <div class="seat"></div>
        <div class="seat"></div>
      </div>

      <div class="row">
        <div class="seat"></div>
        <div class="seat"></div>
        <div class="seat"></div>
        <div class="seat sold"></div>
        <div class="seat sold"></div>
        <div class="seat"></div>
        <div class="seat"></div>
        <div class="seat"></div>
      </div>

      <div class="row">
        <div class="seat"></div>
        <div class="seat"></div>
        <div class="seat"></div>
        <div class="seat"></div>
        <div class="seat"></div>
        <div class="seat"></div>
        <div class="seat sold"></div>
        <div class="seat sold"></div>
      </div>

      <div class="row">
        <div class="seat"></div>
        <div class="seat"></div>
        <div class="seat"></div>
        <div class="seat"></div>
        <div class="seat"></div>
        <div class="seat"></div>
        <div class="seat"></div>
        <div class="seat"></div>
      </div>

      <div class="row">
        <div class="seat"></div>
        <div class="seat"></div>
        <div class="seat"></div>
        <div class="seat sold"></div>
        <div class="seat sold"></div>
        <div class="seat"></div>
        <div class="seat"></div>
        <div class="seat"></div>
      </div>
      <div class="row">
        <div class="seat"></div>
        <div class="seat"></div>
        <div class="seat"></div>
        <div class="seat"></div>
        <div class="seat sold"></div>
        <div class="seat sold"></div>
        <div class="seat sold"></div>
        <div class="seat"></div>
      </div>
        <!-- Additional rows omitted for brevity -->
      </div>
    
      <p class="text">
        You have selected <span id="count">0</span> seat(s) for a total price of <br> ₹<span id="total">0</span>.
      </p>
    
      <div class="buttons">
        <button class="button undo">Undo</button>
        <button class="button" id="confirmBooking">Confirm Booking</button>
      </div>
    </div>
  
    <script>
      // Get references
      const container = document.querySelector(".container");
    const seats = document.querySelectorAll(".row .seat");
    const count = document.getElementById("count");
    const total = document.getElementById("total");
    const movieSelect = document.getElementById("movie");
    
    let ticketPrice = +movieSelect.value;
    const selectionStack = [];
    
    // Movie selection change
    movieSelect.addEventListener("change", (e) => {
      ticketPrice = +e.target.value;
      updateSelectedCount();
    });
    
    // Seat click listener (only affect non-sold seats)
    container.addEventListener("click", (e) => {
      if (e.target.classList.contains("seat") && !e.target.classList.contains("sold")) {
        e.target.classList.toggle("selected");
        if (e.target.classList.contains("selected")) {
          selectionStack.push(e.target);
        } else {
          removeSeat(e.target);
        }
        updateSelectedCount();
      }
    });
    
    // Update selected count and total
    function updateSelectedCount() {
      const selectedSeats = document.querySelectorAll(".row .seat.selected");
      count.innerText = selectedSeats.length;
      total.innerText = selectedSeats.length * ticketPrice;
    }
    
    // Remove seat from stack
    function removeSeat(seat) {
      const index = selectionStack.indexOf(seat);
      if (index !== -1) {
        selectionStack.splice(index, 1);
      }
    }
    
    // Finalize selection (turn selected into sold and save booking data)
    function finalizeSelection() {
      const selectedSeats = document.querySelectorAll(".row .seat.selected");
      const allSeats = document.querySelectorAll(".row .seat");
      const soldIndices = JSON.parse(localStorage.getItem("soldSeats")) || [];
    
      selectedSeats.forEach((seat) => {
        seat.classList.add("sold");
        seat.classList.remove("selected");
        const index = Array.from(allSeats).indexOf(seat);
        if (!soldIndices.includes(index)) {
          soldIndices.push(index);
        }
      });
    
      localStorage.setItem("soldSeats", JSON.stringify(soldIndices));
    
      const bookingData = {
        movieName: movieSelect.options[movieSelect.selectedIndex].text,
        seatCount: selectedSeats.length,
        totalPrice: selectedSeats.length * ticketPrice
      };
      localStorage.setItem("bookingData", JSON.stringify(bookingData));
    
      selectionStack.length = 0;
      updateSelectedCount();
      alert("Seats booked successfully!");
    }
    
    // Undo last selection
    function undoLastSelection() {
      if (selectionStack.length === 0) return;
      const lastSelectedSeat = selectionStack.pop();
      if (lastSelectedSeat) {
        lastSelectedSeat.classList.remove("selected");
        updateSelectedCount();
      }
    }
    
    // Attach event listeners
    document.querySelector(".undo").addEventListener("click", undoLastSelection);
    document.getElementById("confirmBooking").addEventListener("click", () => {
      finalizeSelection();
      window.location.href = "ticket.html"; // Redirect to ticket page
    });
    
    // Load sold seats on page load
    function loadSoldSeats() {
      const soldIndices = JSON.parse(localStorage.getItem("soldSeats")) || [];
      const allSeats = document.querySelectorAll(".row .seat");
      soldIndices.forEach(index => {
        if (allSeats[index]) {
          allSeats[index].classList.add("sold");
        }
      });
    }
    
    document.addEventListener("DOMContentLoaded", () => {
      loadSoldSeats();
      updateSelectedCount();
    });

    </script>
  </body>
</html>
